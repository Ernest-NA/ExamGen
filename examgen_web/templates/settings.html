{% extends "base.html" %}
{% from 'partials/_macros.html' import button, field %}
{% block title %}Ajustes · ExamGen{% endblock %}
{% block content %}
<section class="card">
  <h2>Ajustes</h2>
  <h3>Base de datos</h3>
  <p><strong>URL:</strong> {{ db.url }}</p>
  {% if db.exists %}
    <p>Tamaño: {{ db.size }} bytes · Modificado: {{ db.mtime }}</p>
  {% else %}
    <p>No se encontró el archivo de BD.</p>
  {% endif %}
  <form method="post" action="{{ url_for('settings.backup_db') }}">
    {{ button('Hacer backup ahora', type='submit') }}
  </form>
  <h3>Historial</h3>
  <p>Archivo: {{ history.path }}</p>
  <p>Tamaño: {{ history.size }} bytes</p>
  <form method="post" action="{{ url_for('settings.clear_history') }}">
    {{ button('Limpiar historial', type='submit', variant='secondary') }}
  </form>
  <h4>Últimos eventos</h4>
  <ul>
    {% for ev in history.events %}
      <li>{{ ev.get('ts') }} · {{ ev.get('entity') }} · {{ ev.get('action') }}</li>
    {% endfor %}
  </ul>
  <h3>Restaurar BD</h3>
  <form method="post" action="{{ url_for('settings.restore_db') }}" enctype="multipart/form-data">
    {{ field('file', 'Archivo .db', type='file', attrs='required accept=.db') }}
    <div class="actions">{{ button('Restaurar', type='submit') }}</div>
  </form>
  <h3>Dependencias</h3>
  <p>WeasyPrint: {{ 'OK' if pdf_ok else 'No encontrado' }}</p>
</section>
{% endblock %}
